include:
  - evic-help-housing-checklist.yml
---
code: |
  client.initializeAttribute('rent', DAObject)
  client.initializeAttribute('owed', DAObject)
  client.initializeAttribute('subsidy', DAObject)

  has_subsidy = False
  potential_subsidy = False

  if sum(client.subsidy.types.values()) == 0:
    potential_subsidy = not client.subsidy.no_change
  else:
    has_subsidy = True
  
  if has_subsidy or potential_subsidy:
    seen_subsidy_warning
    client.rent.subsidized_cost
       
  bad_conditions_completed
  
  if client.owed.owes_rent is True:
    client.owed.rent
  
  if len(bad_conditions_string) > 0:
    if client.owed.owes_rent == True and client.rent.should_be_reduced == True:
      client.owed.reduction = client.owed.rent - client.owed.reduced_rent

  known_issues = []
  for time in [1, 5, 30]:
    if len(problems_to_fix[time]) > 0:
      known_issues += problems_to_fix[time]
      
  if additional_conditions_present == True:
    known_issues.append(additional_conditions)
      
  if len(bad_conditions_string) > 0:
    repairs 
    total_repairs = "I would like my landlord to address the following issues: \n" + ", ".join(known_issues) + "\n" + repairs
      
  if case.payments_to != "none":
    case.payment_amount
    
  processed_intro = True
---
question: |
  ${question_id("Worksheet:2")}What is (your unit's- CR delete) address?
fields:
  - no label: client.address.address
section: Rent
---
need: client.address.address
question: |
  ${question_id("Worksheet:3")}How often do you pay rent?
field: client.rent.frequency
buttons:
  - weekly
  - monthly
---
need: client.rent.frequency
question: |
  ${question_id("Worksheet:4")}How much rent does your landlord charge every ${ client.rent.frequency[:-2] }?
fields:
  - no label: client.rent.value
    datatype: currency
    min: 0
comment: |
  have some help text or a note 
---
need: client.rent.value
question: |
  ${question_id("Worksheet:5")}What kind of housing do you have?
subquestion: |
 The kind of housing you live in makes a difference to the rights you have and the things you ask for in your agreement. 
  Check all that apply:
fields:
  - no label: client.subsidy.types
    datatype: checkboxes
    choices:
      - Public housing: public
      - Subsidized housing, funded by HUD or Massachusetts: subsidized
      - Section 8 mobile voucher: section 8
      - MRVP mobile voucher: MRVP
      - Other subsidized housing: other
    none of the above: |
      I don't know.
---
question: |
  ${question_id("Worksheet:6")}Do you live in public or subsidized housing?
subquestion: |
  Sometimes it is hard to know if your landlord gets government funds, so you do not have to pay such a high rent .
  These sentences are good ways to figure out if you live in public or subsidized housing. 
  Check the box next to every sentence that is true.
fields:
  - My rent changes when my income changes: client.subsidy.rent_changes
    datatype: yesnowide
  - I pay no more than 30-40% of my income to the rent each month, even if my income changes: client.subsidy.max_rent_limit
    datatype: yesnowide
  - I need to report my income to my landlord each year: client.subsidy.landlord_report
    datatype: yesnowide
  - I need to report my income to a housing authority each year: client.subsidy.authority_report
    datatype: yesnowide
  - My rent does not change even if my income changes: client.subsidy.no_change
    datatype: yesnowide
    uncheck others: True
---
question: |
  ${question_id("Worksheet:7")}Risks to be aware of
subquestion: |
  % if potential_subsidy:
  Based on your answers,
  (CR - do we want to feedback / review answers they gave us?)
  it sounds like you have a housing subsidy and the government helps pay for your rent. 
  If you do live in public or subsidized housing, you need to know about:
  
    * some of the risks you may be taking, and 
    * things you can ask for 
  when you make an agreement with your landlord.
  % endif

  ### All subsidized tenants

  If a you are evicted from any kind of subsidized housing for non-payment of rent, you will not be able to get ![Emergency Assistance shelter]. Your landlord may agree to change the reason for evicting you if you need shelter. Only children under the age of 18 have a right to shelter.
  [Emergency Assistance shelter](https://www.masslegalhelp.org/homelessness "Learn more about EA shelter")
  
  % if client.subsidy.types["section 8"]:
  ### Section 8 vouchers only

  If a constable ends up evicting you, you will probably lose your Section 8 voucher. Your landlord may be willing to change the Notice To Quit so you do not lose your voucher.
    
  If you admit that you violated terms in your lease, the housing authority could decide to "terminate" your lease. It may not matter if they have to evict you or you agree to move out voluntarily.
  
  (CR - and if the housing authority "terminates" your lease.... this means you lose your Section 8 housing voucher also?)
  % endif

  % if client.subsidy.types["public"] or client.subsidy.types["subsidized"] or client.subsidy.types["other"]:
  ### Non-mobile vouchers only

  If you are evicted or you move out voluntarily, you will no longer have a housing subsidy. You will need to apply all over again. And the waitlist is up to 5 years.
  % endif
field: seen_subsidy_warning
---
question: |
  ${question_id("Worksheet:8")}What portion of the rent do you pay?
subquestion: |
  This should be less than the current rent of $${ client.rent.value }
fields: 
  - no label: client.rent.subsidized_cost
    datatype: currency
    min: 0
    max: ${ client.rent.value }
---
need: client.subsidy.types
question: |
  ${question_id("Worksheet:9")}Do you owe rent?
yesnomaybe: client.owed.owes_rent
---
question: |
  ${question_id("Worksheet:10")}How much rent do you owe?
fields:
  - no label: client.owed.rent
    datatype: currency
    min: 0
---
question: |
  ${question_id("Worksheet:11")}Should your landlord lower your rent?
subquestion: |
  One reason your landlord should lower your rent is because of the bad conditions in your apartment.
yesno: client.rent.should_be_reduced
---
question: |
  ${question_id("Worksheet:12")}What should the lower rent be?
subquestion: |
  For reference, you said you owe $${ client.owed.rent }
fields:
  - no label: client.owed.reduced_rent
    datatype: currency
    min: 0
    max: ${ client.owed.rent }
  - I don't know: client.owed.unknown_reduction
    datatype: yesnowide
---
question: |
  ${question_id("Worksheet:13")}Does the apartment need repairs?
subquestion: |
  % if len(known_issues) > 0:
  If there are any additional repairs or conditions you yould like mentioned, please add them here.
  CR edit: Describe or list any more repairs or bad conditions your apartment needs fixing.
  
  The problems you already told me about are:
    <ul>
    % for issue in known_issues:
      <li>${ issue }</li>
    % endfor
    </ul>
  % else:
    You did not describe any issues.
  % endif
fields:
  - no label: repairs
    datatype: area
    required: false
---
section: Payments
question: |
  ${question_id("Worksheet:14")}Does your landlord owe you money?
fields:
  - note: Reasons your landlord may owe your money
  - no label: landlord.reasons_to_owe
    datatype: checkboxes
    choices:
      - Utilities: utilities
      - Security Deposit: deposit
      - Entering your apartment without permission: entering
      - I paid for repairs: repairs
      - other: other
  - Other issues: landlord.other_reasons_to_owe
    datatype: area
    show if: landlord.reasons_to_owe['other']
---
question: |
  ${question_id("Worksheet:15")}Should your landlord lower the rent you owe?
fields:
  - no label: landlord.should_reduce_rent  
    datatype: yesnoradio
  - "What should the reduced amount be?": client.rent.reduced_value
    datatype: currency
    min: 0
    max: client.owed.rent
    js show if: |
      val("landlord.should_reduce_rent") === true
---
question: |
  ${question_id("Worksheet:16")}Do you need a payment plan to help you pay back rent you owe?
yesno: client.owed.payment_plan
---
question: |
  Describe how you would like to pay your landlord
---
section: Payments
question: |
  ${question_id("Worksheet:17")}Who should pay whom?
subquestion: |
  You may want to pay your landlord back rent, while you are waiting for a court decision (?), or to resolve their claims (need better Plain Language here).
  You might want your landlord to pay you for repairs living with bad conditions...(to resolve your claims).
fields: 
  - no label: case.payments_to
    datatype: radio
    choices: 
      - I would like to make payments to my landlord: landlord
      - My landlord should pay me: tenant
      - No: none
---
question: | 
  ${question_id("Worksheet:18")}Tell me about the payments ${ "you" if case.payments_to == "tenant" else "your landlord" } should make.
fields: 
  - note: How much should they/you (variable to be defined) pay?
  - no label: case.payment_amount
    datatype: currency
  - note: | 
      How should ${ "you" if case.payments_to == "tenant" else "your landlord" } pay.
      This could be payments on a certain date, a rent credit, or some other way
    datatype: area
---